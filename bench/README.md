Work in progress here. There is a working version in branch legacy-main.
